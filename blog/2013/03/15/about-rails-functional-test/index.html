<p>layout: post
title: &#8220;关于rails控制器的功能测试&#8221;
date: 2013-03-15 15:16
comments: true</p>

<h2>categories: </h2>

<h1>控制器的功能测试</h1>

<pre><code> require File.dirname(__FILE__) + '/../test_helper'
</code></pre>

<p>关键在于setup方法，有三个东西</p>

<pre><code>1.controller
2.request
3.response
</code></pre>

<p>get()方法时由测试辅助类提供的，它会模拟controller的web请求，并获取控制器的响应，
然后用assert_response来检查是否应答正确</p>

<p>-n可以指定运行某一个特定的测试方法</p>

<pre><code> ruby test/functional/logni_controller_test.rb -n test_index
</code></pre>

<p>assert_redirected_to :action=>&#8221;login&#8221;</p>

<h1>Dynamic Fixtures</h1>

<p>在夹具中也可以使用ruby代码动态加入</p>

<p>assert_template &#8220;index&#8221; 对模版进行断言</p>

<h1>测试登录</h1>

<pre><code>def test_login
  dave = users(:dave)
  post :login, :nmae=&gt;dave.name, :password=&gt;'secret'
  assert_redirected_to :action=&gt;"index"
  assert_equal dave.id, session[:user_id]
end
</code></pre>

<h1>HTTP请求方法</h1>

<p>get()  对指定的action执行一次HTTP GET请求，并将结果放入HTTP RESPONSE</p>

<pre><code>例: get(action,parameteres=nil,session=nil,flash=nil)
</code></pre>

<p>post() 提交表单</p>

<pre><code>例: post :edit, :user =&gt; {:name =&gt; "dave", :age =&gt; "24"}

 模拟XMLHttp请求
 xhr(method,action,parameters,session,flash)
</code></pre>

<p>put(),delete(),head()</p>

<h1>功能测试的断言</h1>

<pre><code> assert_dom_equal(expected_html,actual_html,message)
 例:assert_dom_equal(expected,@response.body)

 assert_response(type,message)
 type的种类
 1.:success
 2.:redirect
 3.:missing
 4.:error
 例:assert_response :success
</code></pre>

<h1>变量</h1>

<pre><code> assigns(key=nil)
      assert_not_nil assigns["items"]
 session
      assert_equal 2, session[:cart].items.size
 flash
      assert_equal "Danger!", flash[:notice]
 cookies
      assert_equal "Danger!", cookies[:name]
 redirect_to_url
      assert_equal "http://test.host/login", redirect_to_url
</code></pre>

<h1>辅助方法</h1>

<pre><code> find_tag(conditions)
 find_all_tag(conditions)
 follow_redirect
 fixture_file_upload(path,mime_type)
</code></pre>

<h1>测试response的content</h1>

<p>   使用强大的assert_select</p>

<pre><code> assert_select "title",  "TEST"
</code></pre>
